{"version":3,"sources":["components/MapLegend.js","components/MapVisualizer.js"],"names":["MapLegend","data","statistic","mapViz","mapScale","t","useTranslation","svgRef","useRef","useMeasure","wrapperRef","width","useEffect","svg","select","current","transition","duration","D3_TRANSITION_DURATION","MAP_VIZS","CHOROPLETH","attr","selectAll","remove","text","BUBBLE","SPIKES","call","g","spike","statisticConfig","STATISTIC_CONFIGS","zoom","MAP_DIMENSIONS","domain","domainMax","legend","legendRadius","map","d","join","color","yScale","copy","range","axisRight","tickSize","tickPadding","tickValues","tickFormat","num","formatNumber","format","style","SPIKE","ticks","slice","reverse","gap","enter","append","i","xScale","length","axisBottom","x","title","height","marginTop","marginRight","marginBottom","marginLeft","ordinalWeights","tickAdjust","interpolate","n","Math","min","rangeRound","quantize","ramp","toDataURL","interpolator","Object","assign","interpolateRound","undefined","round","quantile","invertExtent","thresholds","quantiles","thresholdFormat","scaleLinear","widthScale","reduce","a","b","xPos","w","acc","scaleOrdinal","scaleBand","filter","max","bandwidth","on","node","MAP_LEGEND_HEIGHT","mapConfig","colorScale","Number","isInteger","className","ref","id","preserveAspectRatio","viewBox","position","canvas","context","getContext","fillStyle","fillRect","MapVisualizer","mapCode","isDistrictView","regionHighlighted","setRegionHighlighted","getMapStatistic","transformStatistic","noDistrictData","mapMeta","MAP_META","history","useHistory","geoData","useSWR","geoDataFile","file","json","suspense","revalidateOnFocus","statisticTotal","useMemo","strokeColor","useCallback","alpha","features","mapType","MAP_TYPES","COUNTRY","feature","objects","states","districts","district","properties","state","st_nm","obj","districtsSet","stateCodes","stateCode","STATE_CODES","Set","add","statisticMax","keys","includes","districtData","res","districtName","has","UNKNOWN_DISTRICT_KEY","push","scaleSqrt","clamp","nice","scaleSequential","interpolateReds","interpolateBlues","interpolateGreens","interpolateGreys","interpolatePurples","interpolateOranges","category","interpolatePiYG","colorInterpolator","fillColor","stateData","populateTexts","regionSelection","nonLinear","toTitleCase","onceTouchedRegion","path","geoPath","geoIdentity","T","event","update","exit","stopPropagation","STATE","window","innerWidth","sel","bind","sortedFeatures","value","sort","featureA","featureB","centroid","requestIdleCallback","meshStates","meshDistricts","mesh","stateName","STATE_NAMES","each","highlighted","this","parentNode","appendChild","classnames","zone","hasPrimary","colorInterpolationFilters","type","values"],"mappings":"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","file":"static/js/42.be858f6f.chunk.js","sourcesContent":["import {\n  D3_TRANSITION_DURATION,\n  MAP_DIMENSIONS,\n  MAP_LEGEND_HEIGHT,\n  MAP_VIZS,\n  STATISTIC_CONFIGS,\n} from '../constants';\nimport {formatNumber, spike} from '../utils/commonFunctions';\n\nimport {range, quantile} from 'd3-array';\nimport {axisRight, axisBottom} from 'd3-axis';\nimport {format} from 'd3-format';\nimport {interpolate, interpolateRound, quantize} from 'd3-interpolate';\nimport {scaleLinear, scaleOrdinal, scaleBand} from 'd3-scale';\nimport {select} from 'd3-selection';\nimport {useEffect, useRef} from 'react';\nimport {useTranslation} from 'react-i18next';\nimport {useMeasure} from 'react-use';\n\nfunction MapLegend({data, statistic, mapViz, mapScale}) {\n  const {t} = useTranslation();\n  const svgRef = useRef(null);\n  const [wrapperRef, {width}] = useMeasure();\n\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    const t = svg.transition().duration(D3_TRANSITION_DURATION);\n\n    if (mapViz !== MAP_VIZS.CHOROPLETH) {\n      const t = svg.transition().duration(D3_TRANSITION_DURATION);\n      svg\n        .select('.ramp')\n        .transition(t)\n        .attr('opacity', 0)\n        .attr('display', 'none')\n        .attr('xlink:href', null);\n\n      svg\n        .select('.bars')\n        .selectAll('rect')\n        .transition(t)\n        .attr('opacity', 0)\n        .remove();\n      svg.selectAll('.axis > *:not(.axistext)').remove();\n      svg.select('.axistext').text('');\n    }\n\n    if (mapViz !== MAP_VIZS.BUBBLE) {\n      svg\n        .select('.circles')\n        .selectAll('circle')\n        .transition(t)\n        .attr('r', 0)\n        .attr('cy', 0)\n        .remove();\n      svg.selectAll('.circle-axis > *').remove();\n    }\n\n    if (mapViz !== MAP_VIZS.SPIKES) {\n      svg\n        .select('.spikes')\n        .call((g) =>\n          g.selectAll('path').transition(t).attr('d', spike(0)).remove()\n        )\n        .call((g) => g.selectAll('text').remove())\n        .transition(t)\n        .selectAll('g')\n        .remove();\n      svg.selectAll('.spike-axis > *').remove();\n    }\n  }, [mapViz]);\n\n  useEffect(() => {\n    if (!width) return;\n\n    const svg = select(svgRef.current);\n    const statisticConfig = STATISTIC_CONFIGS[statistic];\n\n    const zoom = width / MAP_DIMENSIONS[0];\n\n    if (mapViz === MAP_VIZS.BUBBLE) {\n      const [, domainMax] = mapScale.domain();\n\n      const legend = svg\n        .select('.circles')\n        .attr('transform', `translate(48,40)`)\n        .attr('text-anchor', 'middle');\n\n      const legendRadius = [0.1, 0.4, 1].map((d) => d * domainMax);\n\n      legend\n        .selectAll('circle')\n        .data(legendRadius)\n        .join('circle')\n        .attr('fill', 'none')\n        .attr('stroke', statisticConfig.color + '70')\n        .transition(t)\n        .attr('cy', (d) => -mapScale(d))\n        .attr('r', (d) => mapScale(d));\n\n      const yScale = mapScale.copy().range([0, -2 * mapScale(domainMax)]);\n\n      svg\n        .select('.circle-axis')\n        .attr('transform', `translate(48,50)`)\n        .transition(t)\n        .call(\n          axisRight(yScale)\n            .tickSize(0)\n            .tickPadding(0)\n            .tickValues(legendRadius)\n            .tickFormat((num) =>\n              formatNumber(\n                num,\n                statisticConfig.format === 'long'\n                  ? 'short'\n                  : statisticConfig.format\n              )\n            )\n        )\n        .selectAll('.tick text')\n        .style('text-anchor', 'middle')\n        .attr('font-size', 10 / zoom);\n\n      svg.select('.circle-axis').call((g) => g.select('.domain').remove());\n    } else if (mapViz === MAP_VIZS.SPIKE) {\n      const ticks = mapScale.ticks(3).slice(1).reverse();\n\n      const gap = 28 / zoom;\n\n      svg\n        .select('.spikes')\n        .attr('transform', `translate(32,24)`)\n        .selectAll('g')\n        .data(ticks)\n        .join((enter) =>\n          enter.append('g').call((g) =>\n            g\n              .append('path')\n              .attr('fill-opacity', 0.3)\n              .attr('d', (d) => spike(0))\n          )\n        )\n        .attr('transform', (d, i) => `translate(${i * gap},0)`)\n        .call((g) =>\n          g\n            .select('path')\n            .transition(t)\n            .attr('d', (d) => spike(mapScale(d)))\n            .attr('fill', statisticConfig.color + '70')\n            .attr('stroke', statisticConfig.color + '70')\n        );\n\n      const xScale = mapScale.copy().range([gap * ticks.length, 0]);\n      svg\n        .select('.spike-axis')\n        .attr('transform', `translate(32,32)`)\n        .transition(t)\n        .call(\n          axisBottom(xScale)\n            .tickSize(0)\n            .tickPadding(0)\n            .tickValues(ticks)\n            .tickFormat((num) =>\n              formatNumber(\n                num,\n                statisticConfig.format === 'long'\n                  ? 'short'\n                  : statisticConfig.format\n              )\n            )\n        )\n        .selectAll('.tick text')\n        .style('text-anchor', 'middle')\n        .attr('font-size', 10 / zoom);\n\n      svg.select('.spike-axis').call((g) => g.select('.domain').remove());\n    } else {\n      svg.call(() =>\n        legend({\n          svg: svg,\n          color: mapScale,\n          width: width,\n          height: MAP_LEGEND_HEIGHT,\n          ticks: 5,\n          tickFormat: function (d, i, n) {\n            if (statisticConfig?.mapConfig?.colorScale) {\n              return d;\n            } else if (mapViz === MAP_VIZS.CHOROPLETH && !Number.isInteger(d)) {\n              return '';\n            } else if (i === n.length - 1) {\n              return formatNumber(d, statisticConfig.format) + '+';\n            } else {\n              return formatNumber(d, statisticConfig.format);\n            }\n          },\n          marginLeft: 2,\n          marginRight: 0,\n        })\n      );\n      svg.attr('class', statisticConfig?.mapConfig?.colorScale ? 'zone' : '');\n    }\n  }, [t, width, statistic, mapScale, mapViz]);\n\n  return (\n    <div\n      className=\"svg-parent maplegend\"\n      ref={wrapperRef}\n      style={{height: 2 * MAP_LEGEND_HEIGHT}}\n    >\n      <svg\n        id=\"legend\"\n        preserveAspectRatio=\"xMinYMid meet\"\n        ref={svgRef}\n        {...(mapViz !== MAP_VIZS.CHOROPLETH && {\n          viewBox: `0 0 ${MAP_DIMENSIONS[0]} ${MAP_LEGEND_HEIGHT}`,\n        })}\n      >\n        <image className=\"ramp\" preserveAspectRatio=\"none\" />\n        <g className=\"bars\"></g>\n        <g className=\"circles\"></g>\n        <g className=\"spikes\"></g>\n        <g className=\"circle-axis\"></g>\n        <g className=\"spike-axis\"></g>\n        <g className=\"axis\">\n          <text className=\"axistext\" />\n        </g>\n      </svg>\n      <canvas\n        className=\"color-scale\"\n        style={{position: 'absolute', height: 0}}\n      />\n    </div>\n  );\n}\n\nexport default MapLegend;\n\nfunction legend({\n  svg,\n  color,\n  title,\n  tickSize = 6,\n  width = 320,\n  height = 44 + tickSize,\n  marginTop = 18,\n  marginRight = 0,\n  marginBottom = 16 + tickSize,\n  marginLeft = 0,\n  ticks = width / 64,\n  tickFormat,\n  tickValues,\n  ordinalWeights,\n} = {}) {\n  const t = svg.transition().duration(D3_TRANSITION_DURATION);\n\n  let tickAdjust = (g) => {\n    const ticks = g.selectAll('.tick line');\n    ticks.attr('y1', marginTop + marginBottom - height);\n    // select(ticks.nodes()[ticks.size() - 1]).remove();\n  };\n  let x;\n\n  // Continuous\n  if (color.interpolate) {\n    const n = Math.min(color.domain().length, color.range().length);\n\n    x = color\n      .copy()\n      .rangeRound(quantize(interpolate(marginLeft, width - marginRight), n));\n\n    svg\n      .select('.ramp')\n      .attr('x', marginLeft)\n      .attr('y', marginTop)\n      .attr('width', width - marginLeft - marginRight)\n      .attr('height', height - marginTop - marginBottom)\n      .attr(\n        'xlink:href',\n        ramp(color.copy().domain(quantize(interpolate(0, 1), n))).toDataURL()\n      );\n  }\n\n  // Sequential\n  else if (color.interpolator) {\n    svg\n      .select('.bars')\n      .selectAll('rect')\n      .transition(t)\n      .attr('opacity', 0)\n      .remove();\n\n    x = Object.assign(\n      color\n        .copy()\n        .interpolator(interpolateRound(marginLeft, width - marginRight)),\n      {\n        range() {\n          return [marginLeft, width - marginRight];\n        },\n      }\n    );\n\n    svg\n      .select('.ramp')\n      .attr('x', marginLeft)\n      .attr('y', marginTop)\n      .attr('width', width - marginLeft - marginRight)\n      .attr('height', height - marginTop - marginBottom)\n      .attr('xlink:href', ramp(color.interpolator()).toDataURL())\n      .attr('display', 'visible')\n      .transition(t)\n      .attr('opacity', 1);\n\n    // scaleSequentialQuantile doesnâ€™t implement ticks or tickFormat.\n    if (!x.ticks) {\n      if (tickValues === undefined) {\n        const n = Math.round(ticks + 1);\n        tickValues = range(n).map((i) => quantile(color.domain(), i / (n - 1)));\n      }\n      if (typeof tickFormat !== 'function') {\n        tickFormat = format(tickFormat === undefined ? ',f' : tickFormat);\n      }\n    }\n  }\n\n  // Threshold\n  else if (color.invertExtent) {\n    const thresholds = color.thresholds\n      ? color.thresholds() // scaleQuantize\n      : color.quantiles\n      ? color.quantiles() // scaleQuantile\n      : color.domain(); // scaleThreshold\n\n    const thresholdFormat =\n      tickFormat === undefined\n        ? (d) => d\n        : typeof tickFormat === 'string'\n        ? format(tickFormat)\n        : tickFormat;\n\n    x = scaleLinear()\n      .domain([-1, color.range().length - 1])\n      .rangeRound([marginLeft, width - marginRight]);\n\n    svg\n      .append('g')\n      .selectAll('rect')\n      .data(color.range())\n      .join('rect')\n      .attr('x', (d, i) => x(i - 1))\n      .attr('y', marginTop)\n      .attr('width', (d, i) => x(i) - x(i - 1))\n      .attr('height', height - marginTop - marginBottom)\n      .attr('fill', (d) => d);\n\n    tickValues = range(-1, thresholds.length);\n    tickFormat = (i) => {\n      if (i === -1) return thresholdFormat(1);\n      else if (i === thresholds.length - 1) return;\n      else if (i === thresholds.length - 2)\n        return thresholdFormat(thresholds[i] + '+', i);\n      return thresholdFormat(thresholds[i], i);\n    };\n  }\n\n  // Ordinal\n  else {\n    svg\n      .select('.ramp')\n      .transition(t)\n      .attr('opacity', 0)\n      .attr('xlink:href', null);\n    if (!ordinalWeights) {\n      x = scaleBand()\n        .domain(color.domain().filter((d) => d))\n        .rangeRound([marginLeft, width - marginRight]);\n      svg\n        .select('.bars')\n        .selectAll('rect')\n        .data(color.domain().filter((d) => d))\n        .join('rect')\n        .attr('x', x)\n        .attr('y', marginTop)\n        .attr('width', Math.max(0, x.bandwidth() - 1))\n        .attr('height', height - marginTop - marginBottom)\n        .attr('fill', color);\n    } else {\n      const widthScale = scaleLinear()\n        .domain([0, ordinalWeights.reduce((a, b) => a + b)])\n        .rangeRound([0, width - marginLeft - marginRight]);\n\n      const xPos = ordinalWeights.map((w, i) =>\n        ordinalWeights\n          .slice(0, i)\n          .reduce((acc, w) => acc + widthScale(w), marginLeft)\n      );\n\n      x = scaleOrdinal().domain(color.domain()).range(xPos);\n\n      svg\n        .select('.bars')\n        .selectAll('rect')\n        .data(color.domain())\n        .join((enter) =>\n          enter\n            .append('rect')\n            .attr('x', x)\n            .attr('width', (d, i) => widthScale(ordinalWeights[i]))\n        )\n        .attr('y', marginTop)\n        .attr('height', height - marginTop - marginBottom)\n        .attr('fill', color)\n        .transition(t)\n        .attr('x', x)\n        .attr('width', (d, i) => widthScale(ordinalWeights[i]))\n        .attr('opacity', 1);\n    }\n\n    tickAdjust = () => {};\n  }\n\n  svg\n    .select('.axis')\n    .attr('transform', `translate(0,${height - marginBottom})`)\n    .transition(t)\n    .attr('class', 'axis')\n    .call(\n      axisBottom(x)\n        .ticks(ticks, typeof tickFormat === 'string' ? tickFormat : undefined)\n        .tickFormat(typeof tickFormat === 'function' ? tickFormat : undefined)\n        .tickSize(tickSize)\n        .tickValues(tickValues)\n    )\n    .on('start', () => {\n      svg.call(tickAdjust).call((svg) => svg.select('.domain').remove());\n    })\n    .call((g) =>\n      g\n        .select('.axistext')\n        .attr('class', 'axistext')\n        .attr('x', marginLeft)\n        .attr('y', marginTop + marginBottom - height - 6)\n        .attr('fill', 'currentColor')\n        .attr('text-anchor', 'start')\n        .attr('font-weight', 'bold')\n        .text(title)\n    );\n\n  return svg.node();\n}\n\nfunction ramp(color, n = 256) {\n  const canvas = select('.color-scale').node();\n  const context = ((canvas.width = n), (canvas.height = 1), canvas).getContext(\n    '2d'\n  );\n  for (let i = 0; i < n; ++i) {\n    context.fillStyle = color(i / (n - 1));\n    context.fillRect(i, 0, 1, 1);\n  }\n  return canvas;\n}\n","import MapLegend from './MapLegend';\n\nimport {\n  D3_TRANSITION_DURATION,\n  MAP_DIMENSIONS,\n  MAP_META,\n  MAP_TYPES,\n  MAP_VIZS,\n  STATE_CODES,\n  STATE_NAMES,\n  STATISTIC_CONFIGS,\n  UNKNOWN_DISTRICT_KEY,\n} from '../constants';\nimport {formatNumber, spike, toTitleCase} from '../utils/commonFunctions';\n\nimport {AlertIcon} from '@primer/octicons-react';\nimport classnames from 'classnames';\nimport {max} from 'd3-array';\nimport {json} from 'd3-fetch';\nimport {geoIdentity, geoPath} from 'd3-geo';\nimport {scaleLinear, scaleSqrt, scaleSequential} from 'd3-scale';\nimport {\n  interpolateReds,\n  interpolateBlues,\n  interpolateGreens,\n  interpolateGreys,\n  interpolatePurples,\n  interpolateOranges,\n  interpolatePiYG,\n} from 'd3-scale-chromatic';\nimport {select} from 'd3-selection';\nimport {transition} from 'd3-transition';\nimport {useCallback, useEffect, useMemo, useRef} from 'react';\nimport {useTranslation} from 'react-i18next';\nimport {useHistory} from 'react-router-dom';\nimport useSWR from 'swr';\nimport {feature, mesh} from 'topojson-client';\n\nconst colorInterpolator = (statistic) => {\n  if (statistic === 'confirmed') {\n    return (t) => interpolateReds(t * 0.85);\n  } else if (statistic === 'active') {\n    return (t) => interpolateBlues(t * 0.85);\n  } else if (statistic === 'recovered') {\n    return (t) => interpolateGreens(t * 0.85);\n  } else if (statistic === 'deceased') {\n    return (t) => interpolateGreys(t * 0.85);\n  } else if (statistic === 'tested') {\n    return (t) => interpolatePurples(t * 0.85);\n  } else if (\n    statistic === 'tpr' ||\n    statistic === 'cfr' ||\n    statistic === 'other'\n  ) {\n    return (t) => interpolateOranges(t * 0.85);\n  } else if (STATISTIC_CONFIGS[statistic]?.category === 'vaccinated') {\n    return (t) => interpolatePiYG(0.15 + 0.35 * (1 - t));\n  } else {\n    return (t) => interpolateOranges(t * 0.85);\n  }\n};\n\nfunction MapVisualizer({\n  mapCode,\n  isDistrictView,\n  mapViz,\n  data,\n  regionHighlighted,\n  setRegionHighlighted,\n  statistic,\n  getMapStatistic,\n  transformStatistic,\n  noDistrictData,\n}) {\n  const {t} = useTranslation();\n  const svgRef = useRef(null);\n\n  const mapMeta = MAP_META[mapCode];\n  const history = useHistory();\n\n  const {data: geoData} = useSWR(\n    mapMeta.geoDataFile,\n    async (file) => {\n      return await json(file);\n    },\n    {suspense: false, revalidateOnFocus: false}\n  );\n\n  const statisticTotal = useMemo(() => {\n    return getMapStatistic(data[mapCode]);\n  }, [data, mapCode, getMapStatistic]);\n\n  const statisticConfig = STATISTIC_CONFIGS[statistic];\n\n  const strokeColor = useCallback(\n    (alpha) => (statisticConfig?.color || '#343a40') + alpha,\n    [statisticConfig]\n  );\n\n  const features = useMemo(() => {\n    if (!geoData) return null;\n\n    const featuresWrap = !isDistrictView\n      ? feature(geoData, geoData.objects.states).features\n      : mapMeta.mapType === MAP_TYPES.COUNTRY && mapViz !== MAP_VIZS.CHOROPLETH\n      ? [\n          ...feature(geoData, geoData.objects.states).features,\n          ...feature(geoData, geoData.objects.districts).features,\n        ]\n      : feature(geoData, geoData.objects.districts).features;\n    // Add id to each feature\n    return featuresWrap.map((feature) => {\n      const district = feature.properties.district;\n      const state = feature.properties.st_nm;\n      const obj = Object.assign({}, feature);\n      obj.id = `${mapCode}-${state}${district ? '-' + district : ''}`;\n      return obj;\n    });\n  }, [geoData, mapCode, isDistrictView, mapViz, mapMeta]);\n\n  const districtsSet = useMemo(() => {\n    if (!geoData || !isDistrictView) return {};\n    return feature(geoData, geoData.objects.districts).features.reduce(\n      (stateCodes, feature) => {\n        const stateCode = STATE_CODES[feature.properties.st_nm];\n        if (!stateCodes[stateCode]) {\n          stateCodes[stateCode] = new Set();\n        }\n        stateCodes[stateCode].add(feature.properties.district);\n        return stateCodes;\n      },\n      {}\n    );\n  }, [geoData, isDistrictView]);\n\n  const statisticMax = useMemo(() => {\n    const stateCodes = Object.keys(data).filter(\n      (stateCode) =>\n        stateCode !== 'TT' && Object.keys(MAP_META).includes(stateCode)\n    );\n\n    if (!isDistrictView) {\n      return max(stateCodes, (stateCode) =>\n        transformStatistic(getMapStatistic(data[stateCode]))\n      );\n    } else {\n      const districtData = stateCodes.reduce((res, stateCode) => {\n        const districts = Object.keys(data[stateCode]?.districts || []).filter(\n          (districtName) =>\n            (districtsSet?.[stateCode] || new Set()).has(districtName) ||\n            (mapViz !== MAP_VIZS.CHOROPLETH &&\n              districtName === UNKNOWN_DISTRICT_KEY)\n        );\n        res.push(\n          ...districts.map((districtName) =>\n            transformStatistic(\n              getMapStatistic(data[stateCode].districts[districtName])\n            )\n          )\n        );\n        return res;\n      }, []);\n      return max(districtData);\n    }\n  }, [\n    data,\n    isDistrictView,\n    getMapStatistic,\n    mapViz,\n    districtsSet,\n    transformStatistic,\n  ]);\n\n  const mapScale = useMemo(() => {\n    if (mapViz === MAP_VIZS.BUBBLE) {\n      // No negative values\n      return scaleSqrt([0, Math.max(1, statisticMax || 0)], [0, 40])\n        .clamp(true)\n        .nice(3);\n    } else if (mapViz === MAP_VIZS.SPIKE) {\n      return scaleLinear([0, Math.max(1, statisticMax || 0)], [0, 80])\n        .clamp(true)\n        .nice(3);\n    } else if (STATISTIC_CONFIGS[statistic]?.mapConfig?.colorScale) {\n      return STATISTIC_CONFIGS[statistic].mapConfig.colorScale;\n    } else {\n      // No negative values\n      return scaleSequential(\n        [0, Math.max(1, statisticMax || 0)],\n        colorInterpolator(statistic)\n      ).clamp(true);\n    }\n  }, [mapViz, statistic, statisticMax]);\n\n  const fillColor = useCallback(\n    (d) => {\n      if (mapViz === MAP_VIZS.CHOROPLETH) {\n        const stateCode = STATE_CODES[d.properties.st_nm];\n        const district = d.properties.district;\n        const stateData = data[stateCode];\n        const districtData = stateData?.districts?.[district];\n        const n = transformStatistic(\n          getMapStatistic(district ? districtData : stateData)\n        );\n        const color = n ? mapScale(n) : '#ffffff00';\n        return color;\n      }\n    },\n    [mapViz, data, mapScale, getMapStatistic, transformStatistic]\n  );\n\n  const populateTexts = useCallback(\n    (regionSelection) => {\n      regionSelection.select('title').text((d) => {\n        if (mapViz !== MAP_VIZS.CHOROPLETH && !statisticConfig?.nonLinear) {\n          const state = d.properties.st_nm;\n          const stateCode = STATE_CODES[state];\n          const district = d.properties.district;\n\n          const stateData = data[stateCode];\n          const districtData = stateData?.districts?.[district];\n          let n;\n          if (district) n = getMapStatistic(districtData);\n          else n = getMapStatistic(stateData);\n          return `${formatNumber(\n            100 * (n / (statisticTotal || 0.001)),\n            '%'\n          )} from ${toTitleCase(district ? district : state)}`;\n        }\n      });\n    },\n    [mapViz, data, getMapStatistic, statisticTotal, statisticConfig]\n  );\n\n  const onceTouchedRegion = useRef(null);\n\n  // Reset on tapping outside map\n  useEffect(() => {\n    const svg = select(svgRef.current);\n\n    svg.attr('pointer-events', 'auto').on('click', () => {\n      onceTouchedRegion.current = null;\n      setRegionHighlighted({\n        stateCode: mapCode,\n        districtName: null,\n      });\n    });\n  }, [mapCode, setRegionHighlighted]);\n\n  const path = useMemo(() => {\n    if (!geoData) return null;\n    return geoPath(geoIdentity());\n  }, [geoData]);\n\n  // Choropleth\n  useEffect(() => {\n    if (!geoData) return;\n    const svg = select(svgRef.current);\n    const T = transition().duration(D3_TRANSITION_DURATION);\n\n    svg\n      .select('.regions')\n      .selectAll('path')\n      .data(mapViz === MAP_VIZS.CHOROPLETH ? features : [], (d) => d.id)\n      .join(\n        (enter) =>\n          enter\n            .append('path')\n            .attr('d', path)\n            .attr('stroke-width', 1.8)\n            .attr('stroke-opacity', 0)\n            .style('cursor', 'pointer')\n            .on('mouseenter', (event, d) => {\n              if (onceTouchedRegion.current) return;\n              setRegionHighlighted({\n                stateCode: STATE_CODES[d.properties.st_nm],\n                districtName: d.properties.district,\n              });\n            })\n            .on('pointerdown', (event, d) => {\n              if (onceTouchedRegion.current === d)\n                onceTouchedRegion.current = null;\n              else onceTouchedRegion.current = d;\n              setRegionHighlighted({\n                stateCode: STATE_CODES[d.properties.st_nm],\n                districtName: d.properties.district,\n              });\n            })\n            .attr('fill', '#fff0')\n            .attr('stroke', '#fff0'),\n        (update) => update,\n        (exit) =>\n          exit\n            .transition(T)\n            .attr('stroke', '#fff0')\n            .attr('fill', '#fff0')\n            .remove()\n      )\n      .attr('pointer-events', 'all')\n      .on('click', (event, d) => {\n        event.stopPropagation();\n        const stateCode = STATE_CODES[d.properties.st_nm];\n        if (\n          onceTouchedRegion.current ||\n          mapMeta.mapType === MAP_TYPES.STATE ||\n          !data[stateCode]?.districts\n        )\n          return;\n        // Disable pointer events till the new map is rendered\n        svg.attr('pointer-events', 'none');\n        svg.select('.regions').selectAll('path').attr('pointer-events', 'none');\n        // Switch map\n        history.push(\n          `/state/${stateCode}${window.innerWidth < 769 ? '#MapExplorer' : ''}`\n        );\n      })\n      .call((sel) => {\n        sel\n          .transition(T)\n          .attr('fill', fillColor)\n          .attr('stroke', strokeColor.bind(this, ''));\n      });\n  }, [\n    mapViz,\n    data,\n    features,\n    fillColor,\n    geoData,\n    history,\n    mapMeta.mapType,\n    path,\n    setRegionHighlighted,\n    strokeColor,\n  ]);\n\n  const sortedFeatures = useMemo(() => {\n    if (mapViz === MAP_VIZS.CHOROPLETH) {\n      return [];\n    } else {\n      return (features || [])\n        .map((feature) => {\n          const stateCode = STATE_CODES[feature.properties.st_nm];\n          const districtName = feature.properties.district;\n          const stateData = data[stateCode];\n\n          if (!isDistrictView) {\n            feature.value = getMapStatistic(stateData);\n          } else {\n            const districtData = stateData?.districts?.[districtName];\n\n            if (districtName) feature.value = getMapStatistic(districtData);\n            else\n              feature.value = getMapStatistic(\n                stateData?.districts?.[UNKNOWN_DISTRICT_KEY]\n              );\n          }\n\n          return feature;\n        })\n        .filter((feature) => feature.value > 0)\n        .sort((featureA, featureB) => featureB.value - featureB.value);\n    }\n  }, [mapViz, isDistrictView, getMapStatistic, features, data]);\n\n  // Bubble\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    const T = transition().duration(D3_TRANSITION_DURATION);\n\n    const regionSelection = svg\n      .select('.circles')\n      .selectAll('circle')\n      .data(\n        mapViz === MAP_VIZS.BUBBLE ? sortedFeatures : [],\n        (feature) => feature.id\n      )\n      .join(\n        (enter) =>\n          enter\n            .append('circle')\n            .attr(\n              'transform',\n              (feature) => `translate(${path.centroid(feature)})`\n            )\n            .attr('fill-opacity', 0.25)\n            .style('cursor', 'pointer')\n            .attr('pointer-events', 'all')\n            .call((enter) => {\n              enter.append('title');\n            }),\n        (update) => update,\n        (exit) => exit.call((exit) => exit.transition(T).attr('r', 0).remove())\n      )\n      .on('mouseenter', (event, feature) => {\n        if (onceTouchedRegion.current) return;\n        setRegionHighlighted({\n          stateCode: STATE_CODES[feature.properties.st_nm],\n          districtName: !isDistrictView\n            ? null\n            : feature.properties.district || UNKNOWN_DISTRICT_KEY,\n        });\n      })\n      .on('pointerdown', (event, feature) => {\n        if (onceTouchedRegion.current === feature)\n          onceTouchedRegion.current = null;\n        else onceTouchedRegion.current = feature;\n        setRegionHighlighted({\n          stateCode: STATE_CODES[feature.properties.st_nm],\n          districtName: !isDistrictView\n            ? null\n            : feature.properties.district || UNKNOWN_DISTRICT_KEY,\n        });\n      })\n      .on('click', (event, feature) => {\n        event.stopPropagation();\n        if (onceTouchedRegion.current || mapMeta.mapType === MAP_TYPES.STATE)\n          return;\n        history.push(\n          `/state/${STATE_CODES[feature.properties.st_nm]}${\n            window.innerWidth < 769 ? '#MapExplorer' : ''\n          }`\n        );\n      })\n      .call((sel) => {\n        sel\n          .transition(T)\n          .attr('fill', statisticConfig.color + '70')\n          .attr('stroke', statisticConfig.color + '70')\n          .attr('r', (feature) => mapScale(feature.value));\n      });\n\n    window.requestIdleCallback(() => {\n      populateTexts(regionSelection);\n    });\n  }, [\n    mapMeta.mapType,\n    mapViz,\n    isDistrictView,\n    sortedFeatures,\n    history,\n    mapScale,\n    path,\n    setRegionHighlighted,\n    populateTexts,\n    statisticConfig,\n    getMapStatistic,\n  ]);\n\n  // Spike (Note: bad unmodular code)\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    const T = transition().duration(D3_TRANSITION_DURATION);\n\n    const regionSelection = svg\n      .select('.spikes')\n      .selectAll('path')\n      .data(\n        mapViz === MAP_VIZS.SPIKE ? sortedFeatures : [],\n        (feature) => feature.id,\n        (feature) => feature.id\n      )\n      .join(\n        (enter) =>\n          enter\n            .append('path')\n            .attr(\n              'transform',\n              (feature) => `translate(${path.centroid(feature)})`\n            )\n            .attr('opacity', 0)\n            .attr('fill-opacity', 0.25)\n            .style('cursor', 'pointer')\n            .attr('pointer-events', 'all')\n            .attr('d', spike(0))\n            .call((enter) => {\n              enter.append('title');\n            }),\n        (update) => update,\n        (exit) =>\n          exit.call((exit) =>\n            exit.transition(T).attr('opacity', 0).attr('d', spike(0)).remove()\n          )\n      )\n      .on('mouseenter', (event, feature) => {\n        if (onceTouchedRegion.current) return;\n        setRegionHighlighted({\n          stateCode: STATE_CODES[feature.properties.st_nm],\n          districtName: !isDistrictView\n            ? null\n            : feature.properties.district || UNKNOWN_DISTRICT_KEY,\n        });\n      })\n      .on('pointerdown', (event, feature) => {\n        if (onceTouchedRegion.current === feature)\n          onceTouchedRegion.current = null;\n        else onceTouchedRegion.current = feature;\n        setRegionHighlighted({\n          stateCode: STATE_CODES[feature.properties.st_nm],\n          districtName: !isDistrictView\n            ? null\n            : feature.properties.district || UNKNOWN_DISTRICT_KEY,\n        });\n      })\n      .on('click', (event, feature) => {\n        event.stopPropagation();\n        if (onceTouchedRegion.current || mapMeta.mapType === MAP_TYPES.STATE)\n          return;\n        history.push(\n          `/state/${STATE_CODES[feature.properties.st_nm]}${\n            window.innerWidth < 769 ? '#MapExplorer' : ''\n          }`\n        );\n      })\n      .call((sel) => {\n        sel\n          .transition(T)\n          .attr('opacity', 1)\n          .attr('fill', statisticConfig.color + '70')\n          .attr('stroke', statisticConfig.color + '70')\n          .attr('d', (feature) => spike(mapScale(feature.value)));\n      });\n\n    window.requestIdleCallback(() => {\n      populateTexts(regionSelection);\n    });\n  }, [\n    mapMeta.mapType,\n    mapViz,\n    isDistrictView,\n    sortedFeatures,\n    history,\n    mapScale,\n    path,\n    setRegionHighlighted,\n    populateTexts,\n    statisticConfig,\n    getMapStatistic,\n  ]);\n\n  // Boundaries\n  useEffect(() => {\n    if (!geoData) return;\n    const svg = select(svgRef.current);\n    const T = transition().duration(D3_TRANSITION_DURATION);\n\n    let meshStates = [];\n    let meshDistricts = [];\n\n    if (mapMeta.mapType === MAP_TYPES.COUNTRY) {\n      meshStates = [mesh(geoData, geoData.objects.states)];\n      meshStates[0].id = `${mapCode}-states`;\n    }\n\n    if (\n      mapMeta.mapType === MAP_TYPES.STATE ||\n      (isDistrictView && mapViz === MAP_VIZS.CHOROPLETH)\n    ) {\n      // Add id to mesh\n      meshDistricts = [mesh(geoData, geoData.objects.districts)];\n      meshDistricts[0].id = `${mapCode}-districts`;\n    }\n\n    svg\n      .select('.state-borders')\n      .attr('fill', 'none')\n      .attr('stroke-width', 1.5)\n      .selectAll('path')\n      .data(meshStates, (d) => d.id)\n      .join(\n        (enter) => enter.append('path').attr('d', path).attr('stroke', '#fff0'),\n        (update) => update,\n        (exit) => exit.transition(T).attr('stroke', '#fff0').remove()\n      )\n      .transition(T)\n      .attr('stroke', strokeColor.bind(this, '40'));\n\n    svg\n      .select('.district-borders')\n      .attr('fill', 'none')\n      .attr('stroke-width', 1.5)\n      .selectAll('path')\n      .data(meshDistricts, (d) => d.id)\n      .join(\n        (enter) =>\n          enter\n            .append('path')\n            .attr('d', path)\n            .attr('d', path)\n            .attr('stroke', '#fff0'),\n        (update) => update,\n        (exit) => exit.transition(T).attr('stroke', '#fff0').remove()\n      )\n      .transition(T)\n      .attr('stroke', strokeColor.bind(this, '40'));\n  }, [\n    geoData,\n    mapMeta,\n    mapCode,\n    mapViz,\n    isDistrictView,\n    statistic,\n    path,\n    strokeColor,\n  ]);\n\n  // Highlight\n  useEffect(() => {\n    const stateCode = regionHighlighted.stateCode;\n    const stateName = STATE_NAMES[stateCode];\n    const district = regionHighlighted.districtName;\n\n    const svg = select(svgRef.current);\n\n    if (mapViz === MAP_VIZS.BUBBLE) {\n      svg\n        .select('.circles')\n        .selectAll('circle')\n        .attr('fill-opacity', (d) => {\n          const highlighted =\n            stateName === d.properties.st_nm &&\n            ((!district && stateCode !== mapCode) ||\n              district === d.properties?.district ||\n              !isDistrictView ||\n              (district === UNKNOWN_DISTRICT_KEY && !d.properties.district));\n          return highlighted ? 1 : 0.25;\n        });\n    } else if (mapViz === MAP_VIZS.SPIKE) {\n      svg\n        .select('.spikes')\n        .selectAll('path')\n        .attr('fill-opacity', (d) => {\n          const highlighted =\n            stateName === d.properties.st_nm &&\n            ((!district && stateCode !== mapCode) ||\n              district === d.properties?.district ||\n              !isDistrictView ||\n              (district === UNKNOWN_DISTRICT_KEY && !d.properties.district));\n          return highlighted ? 1 : 0.25;\n        });\n    } else {\n      svg\n        .select('.regions')\n        .selectAll('path')\n        .each(function (d) {\n          const highlighted =\n            stateName === d.properties.st_nm &&\n            ((!district && stateCode !== mapCode) ||\n              district === d.properties?.district ||\n              !isDistrictView);\n          if (highlighted) this.parentNode.appendChild(this);\n          select(this).attr('stroke-opacity', highlighted ? 1 : 0);\n        });\n    }\n  }, [\n    geoData,\n    data,\n    mapCode,\n    isDistrictView,\n    mapViz,\n    regionHighlighted.stateCode,\n    regionHighlighted.districtName,\n    statistic,\n  ]);\n\n  return (\n    <>\n      <div className=\"svg-parent\">\n        <svg\n          id=\"chart\"\n          className={classnames({\n            zone: !!statisticConfig?.mapConfig?.colorScale,\n          })}\n          viewBox={`0 0 ${MAP_DIMENSIONS[0]} ${MAP_DIMENSIONS[1]}`}\n          preserveAspectRatio=\"xMidYMid meet\"\n          ref={svgRef}\n        >\n          <g className=\"regions\" />\n          <g className=\"state-borders\" />\n          <g className=\"district-borders\" />\n          <g className=\"circles\" />\n          <g className=\"spikes\" />\n        </svg>\n        {noDistrictData && statisticConfig?.hasPrimary && (\n          <div className={classnames('disclaimer', `is-${statistic}`)}>\n            <AlertIcon />\n            <span>\n              {t('District-wise data not available in state bulletin')}\n            </span>\n          </div>\n        )}\n      </div>\n\n      {mapScale && <MapLegend {...{data, statistic, mapViz, mapScale}} />}\n\n      <svg style={{position: 'absolute', height: 0}}>\n        <defs>\n          <filter id=\"balance-color\" colorInterpolationFilters=\"sRGB\">\n            <feColorMatrix\n              type=\"matrix\"\n              values=\"0.91372549  0           0            0  0.08627451\n                      0           0.91372549  0            0  0.08627451\n                      0           0           0.854901961  0  0.145098039\n                      0           0           0            1  0\"\n            />\n          </filter>\n        </defs>\n      </svg>\n    </>\n  );\n}\n\nexport default MapVisualizer;\n"],"sourceRoot":""}